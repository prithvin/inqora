/*!CK:2625972735!*//*1420431232,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["OeaQK"]); }

__d("GraphQLQuery",["createObjectFrom"],function(a,b,c,d,e,f,g){function h(){"use strict";}h.prototype.addField=function(l){"use strict";if(this.fieldSet){this.fieldSet.fields.push(l);}else this.fieldSet=new k.FieldSet([l]);};h.prototype.addFields=function(l){"use strict";l.forEach(this.addField,this);};for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l,m){"use strict";this.rootCall=l;this.fieldSet=m;}k.prototype.toString=function(){"use strict";return (this.rootCall||'')+(this.fieldSet||'');};k.Call=(function(){function l(m,n){"use strict";this.name=m;this.args=n||[];}l.prototype.toString=function(){"use strict";return this.name+'('+this.args.join(',')+')';};return l;})();k.CallValue=(function(){function l(m){"use strict";this.callValue=m;}l.prototype.toString=function(){"use strict";return this.callValue.replace(/[)(}{><,.\\]/g,'\\$&');};return l;})();k.CallVariable=(function(){function l(m){"use strict";this.callVariableName=m;}l.prototype.toString=function(){"use strict";return '<'+this.callVariableName+'>';};return l;})();k.Field=(function(){for(i in h)if(h.hasOwnProperty(i))l[i]=h[i];l.prototype=Object.create(j);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n,o,p,q){"use strict";this.name=p||m;this.fieldName=m;this.calls=n||[];this.fieldSet=o;this.alias=p;this.condition=q;}l.prototype.toString=function(){"use strict";var m='';if(this.condition)m+=this.condition+'?';m+=this.fieldName;if(this.calls.length!==0)m+='.'+this.calls.join('.');if(this.alias)m+=' as '+this.alias;if(this.fieldSet)m+=this.fieldSet;return m;};l.prototype.addCall=function(m){"use strict";this.calls.push(m);};l.prototype.removeCalls=function(m){"use strict";var n=g(m),o=[];for(var p=0;p<this.calls.length;p++)if(!n[this.calls[p].name])o.push(this.calls[p]);this.calls=o;};return l;})();k.FieldSet=(function(){function l(m){"use strict";this.fields=m||[];}l.prototype.toString=function(){"use strict";return '{'+this.fields.join(',')+'}';};return l;})();e.exports=k;},null);
__d("GraphQLParser",["GraphQLQuery"],function(a,b,c,d,e,f,g){function h(l){"use strict";this.queryString=l;this.queryLength=l.length;this.index=-1;this.character=null;this.next();}h.prototype.error=function(l){"use strict";throw new h.SyntaxError(this.queryString,this.index,l);};h.prototype.next=function(l){"use strict";if(l&&l!==this.character)this.error('Expected "'+l+'" instead of "'+this.character+'".');this.index++;if(this.index>this.queryLength){this.error('Expected another character, but at end of string.');}else this.character=this.index===this.queryLength?null:this.queryString[this.index];};h.prototype.end=function(){"use strict";if(this.character)this.error('Expected end of string instead of '+this.character+'.');};h.prototype.whitespace=function(){"use strict";while(this.character===' '||this.character==='\t'||this.character==='\r'||this.character==='\n')this.next();};h.prototype.query=function(l){"use strict";var m=null;if(l){m=new g.Call(this.name(),this.callArguments());this.whitespace();}var n=null;if(this.character==='{')n=this.fieldSet();return new g(m,n);};h.prototype.name=function(){"use strict";var l=this.index;if(this.character===':')this.error('Name cannot begin with :');while(j(this.character))this.next();if(this.index===l)this.error('Expected name.');return this.queryString.substr(l,this.index-l);};h.prototype.fieldSet=function(){"use strict";var l=[];this.next('{');this.whitespace();l.push(this.field());this.whitespace();while(this.character===','){this.next(',');this.whitespace();l.push(this.field());this.whitespace();}this.next('}');return new g.FieldSet(l);};h.prototype.field=function(){"use strict";var l,m,n=this.name();this.whitespace();if(this.character==='?'){this.next('?');this.whitespace();l=this.name();m=n;}else l=n;this.whitespace();var o=this.calls(),p;if(this.character==='a'){this.next('a');this.next('s');this.whitespace();p=this.name();}this.whitespace();var q;if(this.character==='{')q=this.fieldSet();return new g.Field(l,o,q,p,m);};h.prototype.calls=function(){"use strict";var l=[];while(this.character==='.'){this.next('.');this.whitespace();l.push(new g.Call(this.name(),this.callArguments()));this.whitespace();}return l;};h.prototype.callArguments=function(){"use strict";this.next('(');this.whitespace();var l=[];if(this.character!==')'){l.push(this.callArgument());while(this.character===','){this.next(',');this.whitespace();l.push(this.callArgument());}}this.next(')');return l;};h.prototype.callArgument=function(){"use strict";return this.character==='<'?this.callVariable():this.callValue();};h.prototype.callVariable=function(){"use strict";this.next('<');var l=this.name();this.next('>');return new g.CallVariable(l);};h.prototype.callValue=function(){"use strict";var l=this.index,m=false;while(k(this.character)){if(this.character==='\\'){this.next();m=true;}this.next();}if(this.index===l)this.error('Expected call value.');var n=this.index-l,o=this.queryString.substr(l,n);o=o.replace(/\s+$/,'');if(m)for(var p=0;p<n;++p)if(o[p]==='\\'){o=o.substr(0,p)+o.substr(p+1);--n;}return new g.CallValue(o);};h.SyntaxError=(function(){for(var l in Error)if(Error.hasOwnProperty(l))n[l]=Error[l];var m=Error===null?null:Error.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=Error;function n(o,p,q){"use strict";this.queryString=o;this.character=p;this.parserError=q;this.message='Syntax error "'+q+'" '+'at character '+p+' '+'near "'+i(o,p)+'" '+'in query: '+o;}return n;})();function i(l,m){return (l.substr(0,m+1).replace(/\s+/g,' ').substr(-10)+'\u20DD'+l.substr(m+1).replace(/\s+/g,' ').substr(0,10));}function j(l){if(l===null)return false;return l==='_'||l===':'||l==='-'||(l>='0'&&l<='9')||(l>='A'&&l<='Z')||(l>='a'&&l<='z');}function k(l){if(l===null)return false;return l!='('&&l!=')'&&l!='{'&&l!='}'&&l!='<'&&l!='>'&&l!='.'&&l!=',';}h.parseQuery=function(l){var m=new h(l);m.whitespace();var n=m.query(true);m.whitespace();m.end();return n;};h.parseRootlessQuery=function(l){var m=new h(l);m.whitespace();var n=m.query(false);m.whitespace();m.end();return n;};e.exports=h;},null);
__d("PagedQuery",["GraphQLParser","GraphQLQuery","keyOf","isEmpty"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m){"use strict";this.$PagedQuery0=l;this.$PagedQuery1=m;}k.prototype.$PagedQuery2=function(){"use strict";var l=this.findFieldByPath(this.$PagedQuery0);l.removeCalls(['find','after','before','first','last']);return l;};k.prototype.$PagedQuery3=function(l,m,n){"use strict";var o=this.$PagedQuery2(),p=n?'after':'before';o.addCall(new h.Call(p,[l]));var q=n?'first':'last';o.addCall(new h.Call(q,[m]));return this.$PagedQuery0.toString();};k.prototype.$PagedQuery4=function(l){"use strict";var m=this.$PagedQuery1[l];if(typeof m=='object'&&!j(m))return i(m);return null;};k.prototype.$PagedQuery5=function(l){"use strict";var m=this.$PagedQuery4(l);if(m)return m;return this.$PagedQuery1[l];};k.prototype.$PagedQuery6=function(l){"use strict";var m=this.$PagedQuery4(l);if(m)return this.$PagedQuery1[l][m];return this.$PagedQuery1[l];};k.prototype.pageAfterQueryString=function(l,m){"use strict";return this.$PagedQuery3(l,m,true);};k.prototype.pageBeforeQueryString=function(l,m){"use strict";return this.$PagedQuery3(l,m,false);};k.prototype.pageFirstQueryString=function(l){"use strict";var m=this.$PagedQuery2();m.addCall(new h.Call('first',[l]));return this.$PagedQuery0.toString();};k.prototype.pageLastQueryString=function(l){"use strict";var m=this.$PagedQuery2();m.addCall(new h.Call('last',[l]));return this.$PagedQuery0.toString();};k.prototype.findFieldByPath=function(l){"use strict";var m=l,n=this.$PagedQuery5(0);if(l.rootCall.name!=n)throw new Error("Query path does not match root query at top node, "+"expected "+n+", "+"found "+l.name+" instead.");for(var o=1;o<this.$PagedQuery1.length;o++){var p=m.fieldSet.fields,q=false,r=this.$PagedQuery5(o);for(var s=0;s<p.length;s++)if(p[s].fieldName==r){m=p[s];q=true;break;}if(!q)throw new Error("Query path does not match query structure at location "+o+", "+"expected "+r+", "+"not located in "+p);}return m;};k.prototype.findDataByPath=function(l){"use strict";var m=l;for(var n=0;n<this.$PagedQuery1.length;n++){var o=this.$PagedQuery6(n);if(!m||!m[o])throw new Error("Query path does not match payload at location "+n+", "+"expected "+o);m=m[o];}return m;};k.constructFromPath=function(l,m){return new k(g.parseQuery(l),m);};e.exports=k;},null);
__d("PagedQueryCache",["KeyedCallbackManager","GraphQLParser","emptyFunction"],function(a,b,c,d,e,f,g,h,i){function j(k,l,m,n){"use strict";this.$PagedQueryCache0=this.$PagedQueryCache0.bind(this,k),this.$PagedQueryCache1=l;this.$PagedQueryCache2=Object.assign({enableLooping:false},n);var o=this.$PagedQueryCache1.findDataByPath(m),p=o.edges;this.$PagedQueryCache3=o.page_info;this.$PagedQueryCache4=new g();this.$PagedQueryCache5={};this.$PagedQueryCache6={};this.$PagedQueryCache7={};this.$PagedQueryCache8=0;this.$PagedQueryCache9=0;this.$PagedQueryCachea={};this.$PagedQueryCacheb(p,0);if(this.$PagedQueryCache2.allDataLoaded)this.$PagedQueryCachec();}j.prototype.$PagedQueryCache0=function(k,l,m,n,o,p,q){"use strict";var r=h.parseQuery(l),s=m.findFieldByPath(r),t={};for(var u=0;u<s.calls.length;u++){var v=s.calls[u];if(v.args.length>0)t[v.name]=v.args[0].callValue;}Object.assign(t,p);k(l,m,n,o,t,q);};j.prototype.$PagedQueryCacheb=function(k,l){"use strict";var m={},n=false;for(var o=0;o<k.length;o++){if(this.hasLooped())break;var p=l+o,q=k[o].cursor,r=k[o].node,s=this.$PagedQueryCache5[q];if(this.$PagedQueryCache2.enableLooping&&s!==(void 0)){n=true;continue;}var t=this.$PagedQueryCache4.getResource(p);if(t!==(void 0)&&t!=q)throw new Error('Attempting to add cursor '+q+' at location '+p+' which already contains cursor '+t);this.$PagedQueryCache7[r.id]=q;this.$PagedQueryCache6[q]=r;m[p]=q;this.$PagedQueryCache5[q]=p;this.$PagedQueryCache8=Math.min(p,this.$PagedQueryCache8);this.$PagedQueryCache9=Math.max(p,this.$PagedQueryCache9);}if(n)this.$PagedQueryCachec();this.$PagedQueryCache4.addResourcesAndExecute(m);};j.prototype.getItemsAfterCursor=function(k,l,m){"use strict";this.$PagedQueryCached(k,l,true,m);};j.prototype.getItemsBeforeCursor=function(k,l,m){"use strict";this.$PagedQueryCached(k,l,false,m);};j.prototype.$PagedQueryCachee=function(k){"use strict";if(!this.hasLooped())return k;var l=this.$PagedQueryCachef.end-this.$PagedQueryCachef.start+1;while(k<this.$PagedQueryCachef.start||k>this.$PagedQueryCachef.end)if(k<this.$PagedQueryCachef.start){k+=l;}else k-=l;return k;};j.prototype.$PagedQueryCached=function(k,l,m,n){"use strict";var o=this.$PagedQueryCacheg(k);if(!m)o=o-l-1;var p=[];for(var q=1;q<=l;q++)p.push(this.$PagedQueryCachee(o+q));var r=this.$PagedQueryCache4.getUnavailableResourcesFromRequest(p);if(r.length){r=this.$PagedQueryCacheh(r);if(!r.length)return;var s;if(m){if(this.$PagedQueryCache2.enableLooping&&!this.hasNextPage(k)){s=this.$PagedQueryCache1.pageFirstQueryString(l);}else s=this.$PagedQueryCache1.pageAfterQueryString(k,l);}else if(this.$PagedQueryCache2.enableLooping&&!this.hasPreviousPage(k)){s=this.$PagedQueryCache1.pageLastQueryString(l);}else s=this.$PagedQueryCache1.pageBeforeQueryString(k,l);for(var t=0;t<r.length;++t)this.$PagedQueryCachea[r[t]]=true;this.$PagedQueryCachei&&this.$PagedQueryCachei();this.$PagedQueryCache0(s,this.$PagedQueryCache1,r,m?this.$PagedQueryCache2.first_query:this.$PagedQueryCache2.last_query,this.$PagedQueryCache2.persistent_params,this.$PagedQueryCachej.bind(this));}var u=function(v){var w=[];for(var x=0;x<l;x++)w.push(this.$PagedQueryCache6[v[p[x]]]);return w;}.bind(this);this.$PagedQueryCache4.executeOrEnqueue(p,function(v){n(u(v));});};j.prototype.$PagedQueryCachej=function(){"use strict";this.$PagedQueryCachek.apply(this,arguments);};j.prototype.$PagedQueryCacheg=function(k){"use strict";var l=this.$PagedQueryCache5[k];if(l===(void 0))throw new Error("Cursor not found: the request can still be made but the result "+"would not link to the existing data");return l;};j.prototype.setPayloadCallback=function(k){"use strict";this.$PagedQueryCachek=k;};j.prototype.updateData=function(k){"use strict";var l=this.$PagedQueryCache1.findDataByPath(k.query_results),m=l&&l.edges;if(!m)return;for(var n=0;n<m.length;++n){var o=m[n].cursor,p=m[n].node;if(this.$PagedQueryCache6[o]===(void 0))this.$PagedQueryCache6[o]={};for(var q in p)this.$PagedQueryCache6[o][q]=p[q];}};j.prototype.addData=function(k){"use strict";var l=false,m=null,n=0;for(var o in k.query_params){if(o=='after'||o=='before')m=k.query_params[o];if(o=='first'||o=='last'){l=(o=='first');n=k.query_params[o];}}if(this.$PagedQueryCache2.enableLooping&&!m)m=l?this.$PagedQueryCache3.end_cursor:this.$PagedQueryCache3.start_cursor;if(!m||this.$PagedQueryCache5[m]===(void 0))return;var p=this.$PagedQueryCache5[m],q=this.$PagedQueryCache1.findDataByPath(k.query_results);if(!q.edges.length){this.$PagedQueryCachel(k.requested_indices);if(l){this.$PagedQueryCache3.has_next_page=false;this.$PagedQueryCache2.enableLooping&&this.getItemsAfterCursor(m,n,i);}else{this.$PagedQueryCache3.has_previous_page=false;this.$PagedQueryCache2.enableLooping&&this.getItemsBeforeCursor(m,n,i);}return;}var r;if(l){r=p+1;this.$PagedQueryCache3.end_cursor=q.page_info.end_cursor;this.$PagedQueryCache3.has_next_page=q.page_info.has_next_page;}else{r=p-q.edges.length;this.$PagedQueryCache3.start_cursor=q.page_info.start_cursor;this.$PagedQueryCache3.has_previous_page=q.page_info.has_previous_page;}this.$PagedQueryCacheb(q.edges,r);this.$PagedQueryCachel(k.requested_indices);};j.prototype.hasNextPage=function(k){"use strict";var l=this.$PagedQueryCacheg(k);if(this.$PagedQueryCache4.getResource(l+1)){return true;}else if(k==this.$PagedQueryCache3.end_cursor){return this.$PagedQueryCache3.has_next_page;}else throw new Error('hasNextPage called on unknown cursor');};j.prototype.hasPreviousPage=function(k){"use strict";var l=this.$PagedQueryCacheg(k);if(this.$PagedQueryCache4.getResource(l-1)){return true;}else if(k==this.$PagedQueryCache3.start_cursor){return this.$PagedQueryCache3.has_previous_page;}else throw new Error('hasPreviousPage called on unknown cursor');};j.prototype.hasLooped=function(){"use strict";return this.$PagedQueryCache2.enableLooping&&this.$PagedQueryCachef;};j.prototype.getItemAtIndex=function(k,l){"use strict";k=this.$PagedQueryCachee(k);this.$PagedQueryCache4.executeOrEnqueue([k],function(m){l(this.$PagedQueryCache6[m[k]]);}.bind(this));};j.prototype.getItemAtIndexImmediate=function(k){"use strict";k=this.$PagedQueryCachee(k);var l=this.$PagedQueryCache4.getResource(k),m;if(l)m=this.$PagedQueryCache6[l];return m;};j.prototype.getAvailableRange=function(){"use strict";var k=this.$PagedQueryCacheg(this.$PagedQueryCache3.start_cursor),l=this.$PagedQueryCacheg(this.$PagedQueryCache3.end_cursor);return {offset:k,length:l-k+1};};j.prototype.getCursorForID=function(k){"use strict";return this.$PagedQueryCache7[k];};j.prototype.getIndexForID=function(k){"use strict";var l=this.getCursorForID(k);return (l!==(void 0))?this.$PagedQueryCache5[l]:(void 0);};j.prototype.$PagedQueryCachel=function(k){"use strict";if(k)for(var l=0;l<k.length;++l)delete(this.$PagedQueryCachea[k[l]]);};j.prototype.$PagedQueryCacheh=function(k){"use strict";if(!this.$PagedQueryCachea)return k;var l=[];for(var m=0;m<k.length;++m)if(!this.$PagedQueryCachea[k[m]])l.push(k[m]);return l;};j.prototype.$PagedQueryCachec=function(){"use strict";this.$PagedQueryCachef={start:this.$PagedQueryCache8,end:this.$PagedQueryCache9};};j.prototype.setPreFetchCallback=function(k){"use strict";this.$PagedQueryCachei=k;};e.exports=j;},null);
__d("PhotoStorePagedQueryCacheCore",["PagedQuery","PagedQueryCache","merge"],function(a,b,c,d,e,f,g,h,i){for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n){"use strict";var o=m.query_results,p=m.query_metadata,q=g.constructFromPath(p.query_string,p.query_path);this.$PhotoStorePagedQueryCacheCore0=m.set_id;this.$PhotoStorePagedQueryCacheCore1=m.payloadsource;k.constructor.call(this,n,q,o,i({enableLooping:true},p.config));this.setPayloadCallback(this.$PhotoStorePagedQueryCacheCore2.bind(this));}l.prototype.$PhotoStorePagedQueryCacheCore2=function(m){"use strict";m.set_id=this.$PhotoStorePagedQueryCacheCore0;this.broadcastUpdate(this.$PhotoStorePagedQueryCacheCore1,m);};l.prototype.broadcastUpdate=function(m,n){"use strict";};e.exports=l;},null);
__d("sendPagedQueryRequestDefault",["AsyncRequest"],function(a,b,c,d,e,f,g){function h(i,j,k,l,m,n){new g('/ajax/graphql/query/').setData({queryName:l,params:m}).setHandler(function(o){var p=o.getPayload();n({requested_indices:k,query_results:JSON.parse(p.output),query_metadata:{query_string:p.query},query_params:m});}).setAllowCrossPageTransition(true).send();}e.exports=h;},null);
__d("BadgedButton",["Button.react","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=h.createClass({displayName:"BadgedButton",render:function(){var l=this.props.count>1?this.props.pluralLabel:this.props.singularLabel,m=null;if(this.props.count>0)m=(h.createElement("div",{className:(("_4_-d")+(this.props.bounce?' '+"_3yk":''))},this.props.count));return (h.createElement("div",h.__spread({},this.props,{className:j(this.props.className,"_4_-e")}),h.createElement(g,{label:l,use:"confirm",size:"large",className:"_4_-f"}),m));}});e.exports=k;},null);
__d("PhotoCentralUpdates",["Arbiter","merge"],function(a,b,c,d,e,f,g,h){var i={handleUpdate:function(j,k){var l=h({payloadsource:j},k);g.inform('update-photos',l);},handlePhotoSets:function(j,k){var l=h({payloadsource:j},k);g.inform('update-photosets',l);}};e.exports=i;},null);
__d("PhotoStorePagedQueryCache",["PhotoCentralUpdates","PhotoStorePagedQueryCacheCore","sendPagedQueryRequestDefault"],function(a,b,c,d,e,f,g,h,i){for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n){"use strict";k.constructor.call(this,m,n||i);}l.prototype.broadcastUpdate=function(m,n){"use strict";g.handleUpdate(m,n);};e.exports=l;},null);
__d("PhotocropConstraintConstants",[],function(a,b,c,d,e,f){var g={BOUNDARY:'boundary',SQUARE:'square',WIDE:'wide'};g.getAspectRatioForType=function(h){switch(h){case g.SQUARE:return 1;case g.WIDE:return 16/9;default:return null;}};e.exports=g;},null);
__d("PhotocropConstraint",["Vector","PhotocropConstraintConstants","clamp"],function(a,b,c,d,e,f,g,h,i){function j(p){"use strict";this.photocrop=p;this.pos=null;}j.prototype.onMouseMove=function(p,q,r){"use strict";var s=p.sub(this.pos);if(q){this.onResize(s,r);}else this.onMove(s);this.pos=this.pos.add(s);};j.prototype.onMouseDown=function(p){"use strict";this.pos=p;};j.prototype.onResize=function(p,q){"use strict";};j.prototype.onMove=function(p){"use strict";var q=this.photocrop.box,r=this.photocrop.wrapper.offsetWidth,s=this.photocrop.wrapper.offsetHeight;p.x=i(-q.l,p.x,r-q.r);p.y=i(-q.t,p.y,s-q.b);this.photocrop.box=q.add(p);};for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(){"use strict";if(j!==null)j.apply(this,arguments);}m.prototype.onResize=function(p,q){"use strict";var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight;switch(q){case 'ne':t.r+=p.x=i(t.l+r-t.r,p.x,u-t.r);t.t+=p.y=i(-t.t,p.y,t.b-s-t.t);break;case 'nw':t.l+=p.x=i(-t.l,p.x,t.r-r-t.l);t.t+=p.y=i(-t.t,p.y,t.b-s-t.t);break;case 'se':t.r+=p.x=i(t.l+r-t.r,p.x,u-t.r);t.b+=p.y=i(t.t+s-t.b,p.y,v-t.b);break;case 'sw':t.l+=p.x=i(-t.l,p.x,t.r-r-t.l);t.b+=p.y=i(t.t+s-t.b,p.y,v-t.b);break;}};for(k in j)if(j.hasOwnProperty(k))n[k]=j[k];n.prototype=Object.create(l);n.prototype.constructor=n;n.__superConstructor__=j;function n(){"use strict";if(j!==null)j.apply(this,arguments);}n.prototype.setRatio=function(p){"use strict";this.ratio=p;return this;};n.prototype.onMouseDown=function(p){"use strict";l.onMouseDown.call(this,p);var q=this.photocrop.box,r=q.r-q.l,s=q.b-q.t;this.displacement=new g(r,s);};n.prototype.$AspectRatioConstraint0=function(p,q,r,s,t,u){"use strict";var v,w,x,y,z;v=this.displacement.x/this.displacement.y;w=y=i(p,q,r);x=z=i(s,t,u);if(v>this.ratio){x=i(s,w/this.ratio,u);w=x*this.ratio;}else{w=i(p,x*this.ratio,r);x=w/this.ratio;}return new g(w,x);};n.prototype.onResize=function(p,q){"use strict";var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight,w;switch(q){case 'ne':this.displacement=this.displacement.add(p.x,-p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,u-t.l,s,this.displacement.y,t.b);t.r=t.l+w.x;t.t=t.b-w.y;break;case 'nw':this.displacement=this.displacement.add(-p.x,-p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,t.r,s,this.displacement.y,t.b);t.l=t.r-w.x;t.t=t.b-w.y;break;case 'se':this.displacement=this.displacement.add(p.x,p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,u-t.l,s,this.displacement.y,v-t.t);t.r=t.l+w.x;t.b=t.t+w.y;break;case 'sw':this.displacement=this.displacement.add(-p.x,p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,t.r,s,this.displacement.y,v-t.t);t.l=t.r-w.x;t.b=t.t+w.y;break;}};function o(p,q){var r;switch(q){case h.BOUNDARY:r=new m(p);break;case h.WIDE:case h.SQUARE:r=new n(p).setRatio(h.getAspectRatioForType(q));break;default:throw Error('unsupported PhotocropConstraint type');}return r;}e.exports=o;},null);
__d("Photocrop2",["ArbiterMixin","PhotocropConstraintConstants","CSS","DOM","Event","PhotosConst","Rect","Style","Vector","copyProperties","mixin","PhotocropConstraint"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=q(g);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w,x,y){"use strict";this.photo=w;var z=this.getPhotoDimensions();if(y){this.imageDimensions=new o(y.x,y.y);}else this.imageDimensions=new o(z.x,z.y);x.height=x.height||l.PIC_NORMAL_FBX_SIZE;x.width=x.width||l.PIC_NORMAL_FBX_SIZE;p(this,{target:this.photo.parentNode,create_target:false,target_parent:this.photo.parentNode,min_width:l.PIC_NORMAL_FBX_SIZE,min_height:l.PIC_NORMAL_FBX_SIZE,center_x:(z.x||x.width)/2,center_y:(z.y||x.height)/2,constraint_type:h.BOUNDARY},x);this._unscaledMinHeight=this.min_height;this._unscaledMinWidth=this.min_width;this._unscaledHeight=this.height;this._unscaledWidth=this.width;this.setInitialDimensionsAndPos();if(this.create_target){this.target=j.create('div');i.addClass(this.target,'stageCropper');this.target_parent.appendChild(this.target);}i.addClass(this.target,'photocrop');['bg','wrapper','viewport'].forEach(function(aa){this[aa]=j.create('div');i.addClass(this[aa],aa);}.bind(this));this.highlight=j.create('img');i.addClass(this.highlight,'highlight');this.setHighlightSource();i.addClass(this.wrapper,'photocropWrapper');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].forEach(function(aa){var ba=j.create('div');i.addClass(ba,aa);ba.setAttribute('data-cropcorner',aa);this.viewport.appendChild(ba);i.addClass(ba,'profilePicViewportGrabby');}.bind(this));k.listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:k.kill,selectstart:k.kill,click:k.stop});k.listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});k.listen(window,{resize:this.adjustForResize.bind(this)});this.realignToPictureSize();this.redraw();}v.prototype.setInitialDimensionsAndPos=function(){"use strict";this._constraint=r(this,this.constraint_type);var w=h.getAspectRatioForType(this.constraint_type),x=this.getPhotoDimensions();if(w){this._unscaledMinHeight=this._unscaledMinWidth/w;this._unscaledHeight=this._unscaledWidth/w;}this.setNewRatio();var y=Math.min(this.width,x.x),z=Math.min(this.height,x.y);this.min_width=Math.min(this.min_width,x.x);this.min_height=Math.min(this.min_height,x.y);if(w)if(x.x/x.y>w){z=Math.min(z,x.y);y=z*w;this.min_width=this.min_height*w;}else{y=Math.min(y,x.x);z=y/w;this.min_height=this.min_width/w;}var aa=this.center_x-y/2,ba=this.center_y-z/2;this.box=new m(ba,aa+y,ba+z,aa);};v.prototype.getPhotoDimensions=function(){"use strict";return new o(Math.round(parseFloat(n.get(this.photo,'width'))),Math.round(parseFloat(n.get(this.photo,'height'))));};v.prototype.getPhotoPosition=function(){"use strict";return new o(this.photo.offsetLeft,this.photo.offsetTop);};v.prototype.setHighlightSource=function(){"use strict";this.highlight.src=this.photo.src;};v.prototype.setConstraintType=function(w){"use strict";this.constraint_type=w;this.setInitialDimensionsAndPos();this.adjustForResize();};v.prototype.adjustForResize=function(){"use strict";var w=this.ratio,x=this.setNewRatio(),y=x/w;this.box.t*=y;this.box.l*=y;this.box.b*=y;this.box.r*=y;this.redraw();this.realignToPictureSize();};v.prototype.setNewRatio=function(){"use strict";this.ratio=this.getPhotoDimensions().x/this.imageDimensions.x;this.min_width=this.ratio*this._unscaledMinWidth;this.min_height=this.ratio*this._unscaledMinHeight;this.width=Math.max(1,this.ratio)*this._unscaledWidth;this.height=Math.max(1,this.ratio)*this._unscaledHeight;return this.ratio;};v.prototype.realignToPictureSize=function(){"use strict";var w=this.photo;if(!w)return;var x=this.getPhotoDimensions(),y=this.getPhotoPosition();[this.bg,this.wrapper].forEach(function(z){z.style.width=x.x+'px';z.style.height=x.y+'px';z.style.top=y.y+'px';z.style.left=y.x+'px';});};v.prototype.redraw=function(){"use strict";var w=[this.box.t,this.box.r,this.box.b,this.box.l],x=this.getPhotoDimensions();this.highlight.style.width=x.x+"px";this.highlight.style.height=x.y+"px";this.highlight.style.clip="rect("+w.join("px ")+"px)";this.viewport.style.top=this.box.t+"px";this.viewport.style.left=this.box.l+"px";this.viewport.style.height=(this.box.b-this.box.t)+"px";this.viewport.style.width=(this.box.r-this.box.l)+"px";};v.prototype.done=function(w){"use strict";this.freezeViewport=true;if(!w){[this.bg,this.wrapper].forEach(j.remove);if(this.create_target){j.remove(this.target);this.target=null;}else i.removeClass(this.target,'photocrop');}var x=Math.round(this.box.l*(1/this.ratio)),y=Math.round(this.box.t*(1/this.ratio)),z=Math.round(this.box.r*(1/this.ratio)),aa=Math.round(this.box.b*(1/this.ratio));this.inform('done',w);return {x:Math.max(x,0),y:Math.max(y,0),width:z-Math.max(x,0),height:aa-Math.max(y,0)};};v.prototype.reset=function(){"use strict";this.freezeViewport=false;};v.prototype.mousedown=function(w){"use strict";if(this.freezeViewport)return;this.mouseTarget=w.getTarget();this._constraint.onMouseDown(o.getEventPosition(w));i.addClass(document.body,'draggingMode');return false;};v.prototype.mousemove=function(w){"use strict";if(!this.mouseTarget)return;this._constraint.onMouseMove(o.getEventPosition(w),this.mouseTarget!==this.viewport,this.mouseTarget.getAttribute('data-cropcorner'));this.redraw();return false;};v.prototype.mouseup=function(w){"use strict";this.mouseTarget=null;i.removeClass(document.body,'draggingMode');};e.exports=v;},null);
__d("ProfilePicRequestCreator",["URI","XProfilePicSaver","tidyEvent"],function(a,b,c,d,e,f,g,h,i){function j(k,l){"use strict";this.saver=new h(String(k),String(l));i([this.saver.subscribe('success',this.$ProfilePicRequestCreator0.bind(this)),this.saver.subscribe('error',this.$ProfilePicRequestCreator1.bind(this))]);this.setSuccessURI(new g('/profile.php').setQueryData({id:l}));this.setErrorURI(new g('/photo.php').setQueryData({pid:k,profile_id:l}));}j.prototype.setSuccessURI=function(k){"use strict";this.$ProfilePicRequestCreator2=k;return this;};j.prototype.setErrorURI=function(k){"use strict";this.$ProfilePicRequestCreator3=k;return this;};j.prototype.setProfilePhotoSource=function(k){"use strict";k&&this.saver.setProfilePhotoSource(k);return this;};j.prototype.setProfilePhotoMethod=function(k){"use strict";k&&this.saver.setProfilePhotoMethod(k);return this;};j.prototype.setFlowType=function(k){"use strict";this.saver.setFlowType(k);return this;};j.prototype.savePic=function(){"use strict";this.saver.saveAsProfilePic();};j.prototype.saveCrop=function(k,l){"use strict";this.saver.saveCroppedProfilePic({x:k.x/l.x,y:k.y/l.y,width:k.width/l.x,height:k.height/l.y});};j.prototype.$ProfilePicRequestCreator0=function(){"use strict";this.$ProfilePicRequestCreator2.go(true);};j.prototype.$ProfilePicRequestCreator1=function(){"use strict";this.$ProfilePicRequestCreator3.go(true);};e.exports=j;},null);
__d("SpotlightViewerCheck",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){var j=h.createClass({displayName:"SpotlightViewerCheck",getInitialState:function(){return {selected:this.props.selected};},render:function(){var k=((this.props.selected?"_4_d3":'')+(' '+"_4_d2")+(' '+"_51an")+(' '+"_4bi")+(this.props.bounce?' '+"_3yk":''));return h.createElement(g,{className:k,onClick:this.props.onClick});}});e.exports=j;},null);
__d("SpotlightViewerCroppingBar",["React","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=g.createClass({displayName:"SpotlightViewerCroppingBar",_getBarGroupContents:function(){if(this.props.saving)return (g.createElement("span",{className:"_4_8j"},"Saving your new profile picture"));return [g.createElement(j,{onClick:this.props.onDone},"Done Cropping"),g.createElement(j,{onClick:this.props.onCancel},"Cancel")];},render:function(){return (g.createElement(h,null,g.createElement(i,null,this._getBarGroupContents())));}});e.exports=m;},null);
__d("SpotlightViewerOptionsMenu",["ContextualLayerAutoFlip","React","ReactMenu","PopoverMenu.react","SpotlightViewerBottomBarLink","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.Item,n=h.createClass({displayName:"SpotlightViewerOptionsMenu",_onItemClick:function(o,p){this.props.callback&&this.props.callback(p.item.getValue());},render:function(){var o=h.createElement(i,{onItemClick:this._onItemClick},this.props.items.map(function(p){return (h.createElement(m,{value:p.value,title:p.label,href:p.href||'#'},p.label));}));return (h.createElement(j,{menu:o,layerBehaviors:[g],onShow:this.props.onShow,onHide:this.props.onHide},h.createElement(k,null,"Options")));}});e.exports=n;},null);
__d("SpotlightViewerUpdateUrlOnNav",["PageTransitions","PhotoUtils","URI","VaultBoxURI","goURI"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){"use strict";this._viewer=m;this._registered=false;this._shouldUpdateURL=false;this._suppressNextEvent=false;}l.prototype.enable=function(){"use strict";this._registered=false;this._subscriptions=[this._viewer.subscribe('open',this._onOpen.bind(this)),this._viewer.subscribe('close',this._onClose.bind(this)),this._viewer.subscribe('photo_change',this._onPhotoChange.bind(this))];this._enabled=true;};l.prototype.disable=function(){"use strict";for(var m=0;m<this._subscriptions.length;m++)this._subscriptions[m].unsubscribe();this._subscriptions=[];this._enabled=false;};l.prototype._registerTransition=function(){"use strict";if(this._registered)return;g.registerHandler(this._handleTransition.bind(this));this._registered=true;};l.prototype._handleTransition=function(m){"use strict";if(!this._enabled)return false;if(this._shouldUpdateURL){this._shouldUpdateURL=false;g.transitionComplete();return true;}this._suppressNextEvent=true;if(this._viewer.openURL(m)){g.transitionComplete();return true;}if(this._viewer.isOpen()&&j.isVaultArchiveURI(m)){this._suppressNextEvent=true;this._viewer.close();g.transitionComplete();return true;}this._suppressNextEvent=false;return false;};l.prototype._onOpen=function(){"use strict";this._registerTransition();this._openURI=i.getMostRecentURI().getUnqualifiedURI();};l.prototype._onClose=function(){"use strict";if(this._suppressNextEvent){this._suppressNextEvent=false;return;}var m=this._viewer.removePermalinkQueryData(this._openURI);this._updateURL(m);};l.prototype._onPhotoChange=function(m,n){"use strict";if(this._suppressNextEvent){this._suppressNextEvent=false;return;}this._updateURL(h.getPermalinkFromData(n));};l.prototype._updateURL=function(m){"use strict";this._shouldUpdateURL=true;k(m);};e.exports=l;},null);
__d("SpotlightVaultViewer",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","BadgedButton","CSSAnimations","LoadingIndicator.react","Parent","Photocrop2","PhotosConst","PhotoStore","PhotosUploadWaterfall","PhotoUtils","ProfilePicRequestCreator","ProfilePictureFlowLogging","React","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerCheck","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerCroppingBar","SpotlightViewerDimensionMixin","SpotlightViewerOptionsMenu","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerUpdateUrlOnNav","SpotlightViewport","SubscriptionsHandler","URI","VaultBoxURI","VaultPageGrid","Vector","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa){var ta=v.createClass({displayName:"SpotlightVaultViewer",mixins:[h,y,ea,ga],behaviors:[ka,ja,x],getViewerID:function(){return 'vaultbox';},optionsMenuValues:{DOWNLOAD:0,CROP:1,ROTATE_LEFT:2,ROTATE_RIGHT:3,MAKE_COVER_PHOTO:4},getInitialState:function(){this._grid=pa.getInstance(this.props.gridid);this._subscriptions=new ma();return {photoData:this._getInitialPhotoData(),open:true,selectionSet:this._grid.getSelectionSet(),croppingMode:false,savingMode:false,menuOpen:false,bounce:false};},_getInitialPhotoData:function(){var ua=q.getIndexForID(this.props.setid,this.props.photoid),va=q.getByIndexImmediate(this.props.setid,ua);return va?va:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.normaldimensions||!this.props.thumbsrc)return null;var ua=qa.deserialize(this.props.normaldimensions),va={id:this.props.photoid,image1:{width:ua.x,height:ua.y,uri:this.props.thumbsrc}};if(this.props.hiresdimensions){var wa=qa.deserialize(this.props.hiresdimensions);va.image2={width:wa.x,height:wa.y,uri:this.props.thumbsrc};}return va;},_enableSubscriptions:function(){this._subscriptions.addSubscriptions(g.subscribe('VaultSharerDialog/imagesShared',this.close),g.subscribe('SpotlightVaultViewer/imageDeleted',this._onDelete),this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},removePermalinkQueryData:function(ua){if(oa.isVaultBoxURI(ua))return new na(ua).removeQueryData('view_image');return ua;},_onShareClick:function(event){if(this.state.selectionSet.getLength()===0){this.state.selectionSet.add(this._getCurrentFBID());this.setState({selectionSet:this.state.selectionSet});}this._grid.createPost(event.target);},_onSelect:function(){var ua=this._getCurrentFBID();if(!this.state.selectionSet.contains(ua)){this.state.selectionSet.add(ua);}else this.state.selectionSet.remove(ua);this.setState({selectionSet:this.state.selectionSet,bounce:true});setTimeout(this.setState.bind(this,{bounce:false}),l.getBounceTimeout());},_onClickOptions:function(ua){if(ua==this.optionsMenuValues.CROP){this._enableCropping();}else if(ua==this.optionsMenuValues.ROTATE_LEFT){this._rotate('left');}else if(ua==this.optionsMenuValues.ROTATE_RIGHT){this._rotate('right');}else if(ua==this.optionsMenuValues.MAKE_COVER_PHOTO)this.close();},_rotate:function(ua){var va=this._getCurrentFBID(),wa={fbid:va,cs_ver:p.VIEWER_VAULTBOX};wa[ua]=1;var xa=this.viewState.getPosition();new j('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(wa).setFinallyHandler(this.rotationComplete.bind(this,xa)).setErrorHandler(this.rotationComplete.bind(this,xa)).setMethod('POST').setReadOnly(false).send();this.viewState.inform('photo_fetch');},rotationComplete:function(ua){if(ua==this.viewState.getPosition())q.getByIndex(this.props.setid,ua,this._updatePhoto);},_enableCropping:function(){u.setAction(u.action.MAKE_PROFILE).setFlowType(u.flow.VAULT).log(u.step.CROP);var ua=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);this._photocrop=new o(this.refs.image.getDOMNode(),{},ua);this.setState({croppingMode:true});},_disableCropping:function(){u.setFlowType(u.flow.VAULT).log(u.step.CANCEL);this._photocrop&&this._photocrop.done(false);this.setState({croppingMode:false});},componentDidMount:function(){if(this.props.enablecropping)this._enableCropping();},_crop:function(){var ua=this._getCurrentFBID(),va=this.state.photoData.owner.id,wa=this._photocrop.done(),xa=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);new t(ua,va).setErrorURI(na.getRequestURI()).setFlowType(u.flow.VAULT).saveCrop(wa,xa);this.setState({croppingMode:false,savingMode:true});},_isCroppingEnabled:function(){return this.state.croppingMode||this.state.savingMode;},_delete:function(event){var ua=new j('/ajax/vault/delete.php').setData({vault_image_ids:[this._getCurrentFBID()],source:r.SPOTLIGHT_VAULT_VIEWER}).setStatusElement(n.byClass(event.target,'stat_elem')).setRelativeTo(event.target);i.send(ua);},_onDelete:function(){this.close();q.clearSetCache(this.props.setid);},openURL:function(ua){var va=ua.getQueryData('view_image').view_image;if(!va)return false;this.viewState.page(this.viewState.getRelativeMovement(va));return true;},_getBottomBar:function(){if(!this.state.photoData)return null;if(this._isCroppingEnabled())return (v.createElement(fa,{onDone:this._crop,onCancel:this._disableCropping,saving:this.state.savingMode}));return (v.createElement(z,{className:"stat_elem"},v.createElement(aa,null,v.createElement(ba,{onClick:this._delete},"Delete"),this._getOptionsMenu(),v.createElement("div",{className:"_4_8j"},v.createElement(m,{size:m.SIZES.small,color:m.COLORS.blue,showonasync:true,className:"_535k"}))),v.createElement(aa,{itemmargin:"left"},v.createElement(k,{onClick:this._onShareClick,className:"_4_8j",count:this.state.selectionSet.getLength(),singularLabel:"Share Photo",pluralLabel:"Share Photos",bounce:this.state.bounce}))));},_getCheck:function(){if(!this.state.photoData||this._isCroppingEnabled())return null;var ua=this.state.selectionSet.contains(this._getCurrentFBID());return (v.createElement(ca,{bounce:this.state.bounce,selected:ua,onClick:this._onSelect}));},_getPagers:function(){if(this._isCroppingEnabled())return null;return v.createElement(ia,null);},_getOptionsMenu:function(){if(!this.state.photoData)return null;var ua=[],va=s.getDownloadURLFromData(this.state.photoData);if(va)ua.push({label:"Download",value:this.optionsMenuValues.DOWNLOAD,href:s.getDownloadURLFromData(this.state.photoData)});if(this.state.photoData.owner)ua.push({label:"Make Profile Picture",value:this.optionsMenuValues.CROP});if(s.canViewerMakeCoverPhoto(this.state.photoData))ua.push({label:"Make Cover Photo",value:this.optionsMenuValues.MAKE_COVER_PHOTO,href:s.getCoverPhotoURLFromData(this.state.photoData)});ua.push({label:"Rotate Left",value:this.optionsMenuValues.ROTATE_LEFT});ua.push({label:"Rotate Right",value:this.optionsMenuValues.ROTATE_RIGHT});return (v.createElement(ha,{items:ua,callback:this._onClickOptions,onShow:this.setState.bind(this,{menuOpen:true},null),onHide:this.setState.bind(this,{menuOpen:false},null)}));},render:function(){var ua=this.getMedia(),va=this.getStageDimensions();return (v.createElement(w,{open:this.state.open,onHide:this.close},v.createElement(la,{active:this.state.menuOpen,onClick:this._onClickViewport,stageDimensions:va,media:ua,showLoadingIndicator:!this.state.photoData},v.createElement(da,{onClick:this.close,position:"left"}),this._getCheck(),this._getBottomBar(),this._getPagers())));}});e.exports=ta;},null);
__d("VaultBoxInit",["AsyncRequest","DOM","PhotoStore","React","SpotlightVaultViewer","SpotlightViewerInit","VaultPageGrid"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={setID:'vault:images_by_date_taken',bootstrapWithElem:function(o){l.render(j.createElement(k,{open:true,gridid:o.getAttribute('data-grid-id'),setid:n.setID,photoid:o.getAttribute('data-fbid'),thumbsrc:h.find(o,'img').src,hiresdimensions:o.getAttribute('data-hi-res-dimensions'),normaldimensions:o.getAttribute('data-normal-dimensions')}));if(!i.hasBeenCreated(n.setID))new g('/ajax/photos/vaultbox/init_react.php').setRelativeTo(o).setData({photoID:o.getAttribute('data-fbid')}).send();},bootstrapFromPermalink:function(o,p,q,r){m.getInstanceWithCallback(q,function(){l.render(j.createElement(k,{open:true,setid:n.setID,initialpayload:o,photoid:p,gridid:q,enablecropping:r.enableCropping}));});}};e.exports=n;},null);